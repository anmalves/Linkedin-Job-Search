<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <title>LinkedIn Job Search ‚Äì Lens & Minarelli</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        :root {
            --bg-main: #050816;
            --bg-card: #0b1020;
            --bg-input: #111827;
            --border-subtle: #1f2933;
            --accent: #7c3aed;
            --accent-soft: #8b5cf6;
            --accent-strong: #ec4899;
            --text-main: #e5e7eb;
            --text-muted: #9ca3af;
            --danger: #f97373;
            --success: #22c55e;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
                "Segoe UI", sans-serif;
        }

        body {
            background: radial-gradient(circle at top, #111827 0, var(--bg-main) 55%);
            color: var(--text-main);
            min-height: 100vh;
            padding: 24px;
            display: flex;
            justify-content: center;
        }

        .app {
            width: 100%;
            max-width: 1200px;
        }

        header {
            text-align: center;
            margin-bottom: 24px;
        }

        header .badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 4px 10px;
            border-radius: 999px;
            background: rgba(16, 185, 129, 0.14);
            color: #6ee7b7;
            font-size: 12px;
            margin-bottom: 8px;
        }

        header .badge-dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: #22c55e;
            box-shadow: 0 0 10px rgba(34, 197, 94, 0.7);
        }

        header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        header p {
            font-size: 14px;
            color: var(--text-muted);
        }

        .layout {
            display: grid;
            grid-template-columns: minmax(0, 360px) minmax(0, 1fr);
            gap: 20px;
        }

        @media (max-width: 900px) {
            .layout {
                grid-template-columns: minmax(0, 1fr);
            }
        }

        .panel {
            background: radial-gradient(circle at top left, #111827 0, var(--bg-card) 45%);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--border-subtle);
            box-shadow: 0 18px 45px rgba(0, 0, 0, 0.45);
        }

        .panel h2 {
            font-size: 18px;
            margin-bottom: 16px;
        }

        .panel-description {
            font-size: 13px;
            color: var(--text-muted);
            background: rgba(15, 23, 42, 0.9);
            border-radius: 12px;
            padding: 12px 14px;
            border: 1px dashed rgba(148, 163, 184, 0.4);
            margin-bottom: 18px;
            line-height: 1.5;
        }

        .panel-description strong {
            color: #e5e7eb;
        }

        .field {
            margin-bottom: 14px;
        }

        .field label {
            display: block;
            font-size: 13px;
            margin-bottom: 6px;
            color: var(--text-muted);
        }

        .field input[type="text"],
        .field select {
            width: 100%;
            padding: 10px 12px;
            border-radius: 10px;
            border: 1px solid var(--border-subtle);
            background: var(--bg-input);
            color: var(--text-main);
            font-size: 14px;
            outline: none;
            transition: border-color 0.15s ease, box-shadow 0.15s ease,
                background 0.15s ease;
        }

        .field input::placeholder {
            color: #6b7280;
        }

        .field input:focus,
        .field select:focus {
            border-color: var(--accent-soft);
            box-shadow: 0 0 0 1px rgba(139, 92, 246, 0.7);
            background: #020617;
        }

        .seniority-group {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 6px 10px;
            margin-top: 4px;
            font-size: 13px;
        }

        .checkbox-pill {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 8px;
            border-radius: 999px;
            border: 1px solid var(--border-subtle);
            background: rgba(15, 23, 42, 0.9);
            cursor: pointer;
            user-select: none;
        }

        .checkbox-pill input {
            accent-color: var(--accent-soft);
        }

        .actions {
            display: flex;
            gap: 10px;
            margin-top: 16px;
            align-items: center;
        }

        .actions button {
            border-radius: 999px;
            padding: 10px 18px;
            font-size: 14px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: transform 0.12s ease, box-shadow 0.12s ease,
                opacity 0.12s ease;
            white-space: nowrap;
        }

        .btn-primary {
            background-image: linear-gradient(90deg,
                    var(--accent),
                    var(--accent-strong));
            color: #ffffff;
            box-shadow: 0 15px 25px rgba(236, 72, 153, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 18px 32px rgba(236, 72, 153, 0.55);
        }

        .btn-secondary {
            background: rgba(15, 23, 42, 0.95);
            color: var(--text-muted);
            border: 1px solid var(--border-subtle);
        }

        .btn-secondary:hover {
            opacity: 0.9;
        }

        .status-line {
            margin-top: 10px;
            font-size: 12px;
            color: var(--text-muted);
        }

        .status-line.ok {
            color: var(--success);
        }

        .status-line.error {
            color: var(--danger);
        }

        /* Painel de resultados */

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 12px;
            gap: 8px;
        }

        .results-header h2 {
            margin: 0;
        }

        .results-meta {
            font-size: 13px;
            color: var(--text-muted);
        }

        .results-meta strong {
            color: #e5e7eb;
        }

        .results-container {
            border-radius: 12px;
            border: 1px solid var(--border-subtle);
            background: radial-gradient(circle at top left, #020617 0, #020617 50%);
            padding: 12px;
            max-height: 520px;
            overflow-y: auto;
            font-size: 13px;
        }

        .empty-state {
            color: var(--text-muted);
            font-size: 13px;
            padding: 16px;
        }

        .jobs-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .job-card {
            border-radius: 10px;
            padding: 10px 12px;
            background: linear-gradient(135deg,
                    rgba(30, 64, 175, 0.45),
                    rgba(15, 23, 42, 0.98));
            border: 1px solid rgba(129, 140, 248, 0.4);
        }

        .job-title-line {
            display: flex;
            justify-content: space-between;
            gap: 8px;
            align-items: flex-start;
            margin-bottom: 4px;
        }

        .job-title {
            font-size: 14px;
            font-weight: 600;
        }

        .job-company {
            font-size: 13px;
            color: #c4d1ff;
            margin-bottom: 2px;
        }

        .job-location {
            font-size: 12px;
            color: var(--text-muted);
        }

        .job-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 6px;
            gap: 8px;
        }

        .job-date {
            font-size: 12px;
            color: var(--text-muted);
        }

        .job-link {
            font-size: 12px;
            color: #bfdbfe;
            text-decoration: none;
            border-radius: 999px;
            padding: 4px 10px;
            border: 1px solid rgba(59, 130, 246, 0.7);
            background: rgba(15, 23, 42, 0.9);
            white-space: nowrap;
        }

        .job-link:hover {
            background: rgba(37, 99, 235, 0.4);
        }

        /* Abas JSON bruto / Resultado processado */

        .tabs {
            margin-top: 10px;
            display: flex;
            gap: 8px;
            font-size: 12px;
        }

        .tab-btn {
            padding: 4px 10px;
            border-radius: 999px;
            border: 1px solid transparent;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
        }

        .tab-btn.active {
            border-color: rgba(148, 163, 184, 0.7);
            background: rgba(15, 23, 42, 0.9);
            color: #e5e7eb;
        }

        .tab-panel {
            margin-top: 8px;
        }

        .tab-panel.hidden {
            display: none;
        }

        pre.json-raw {
            white-space: pre-wrap;
            word-break: break-word;
            font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
                "Courier New", monospace;
            font-size: 11px;
            color: #e5e7eb;
            background: #020617;
            border-radius: 8px;
            padding: 10px;
            border: 1px solid rgba(31, 41, 55, 0.9);
        }
    </style>
</head>

<body>
    <div class="app">
        <header>
            <div class="badge">
                <span class="badge-dot"></span>
                Job Search ‚Äì Lens & Minarelli
            </div>
            <h1>üîé LinkedIn Job Search</h1>
            <p>
                Busca inteligente de vagas
            </p>
        </header>

        <div class="layout">
            <!-- FILTROS -->
            <section class="panel">
                <h2>Filtros da busca</h2>
                <p class="panel-description">
                    Este formul√°rio envia os filtros para o <strong>Agente de IA</strong>,
                    que chama a <strong>API LinkedIn Jobs</strong> e devolve o
                    resultado em <strong>Cards</strong>.
                </p>

                <form id="searchForm">
                    <div class="field">
                        <label for="keywords">Palavras-chave da vaga</label>
                        <input type="text" id="keywords" name="keywords"
                            placeholder="Ex: Diretor de Vendas, CEO, Marketing..."
                            value="Diretor de Recursos Humanos" />
                    </div>

                    <div class="field">
                        <label for="location">Localiza√ß√£o (c√≥digo pa√≠s ou cidade)</label>
                        <input type="text" id="location" name="location" placeholder="Ex: BR, S√£o Paulo, Lisboa..."
                            value="S√£o Paulo" />
                    </div>

                    <div class="field">
                        <label>Senioridade (Unipile / LinkedIn)</label>
                        <div class="seniority-group">
                            <label class="checkbox-pill">
                                <input type="checkbox" name="seniority" value="1" id="seniority-entry" />
                                <span>Entry / Junior</span>
                            </label>
                            <label class="checkbox-pill">
                                <input type="checkbox" name="seniority" value="2" id="seniority-assoc" />
                                <span>Associate</span>
                            </label>
                            <label class="checkbox-pill">
                                <input type="checkbox" name="seniority" value="3" id="seniority-mid" />
                                <span>Mid-Senior</span>
                            </label>
                            <label class="checkbox-pill">
                                <input type="checkbox" name="seniority" value="4" id="seniority-dir" checked />
                                <span>Director / Executive</span>
                            </label>
                        </div>
                    </div>

                    <div class="actions">
                        <button type="submit" class="btn-primary">
                            üöÄ Buscar vagas
                        </button>
                        <button type="button" id="btnReset" class="btn-secondary">
                            Limpar
                        </button>
                    </div>
                    <div id="statusLine" class="status-line">
                        Aguardando busca.
                    </div>
                </form>
            </section>

            <!-- RESULTADOS -->
            <section class="panel">
                <div class="results-header">
                    <h2>Resultados da API (Unipile)</h2>
                    <div class="results-meta">
                        <span><strong id="resultsCount">0</strong> vagas</span>
                        <span id="resultsHint"> (aguardando primeira busca)</span>
                    </div>
                </div>

                <div class="results-container">
                    <div class="tabs">
                        <button type="button" class="tab-btn active" data-tab="processed">
                            Vagas processadas
                        </button>
                        <button type="button" class="tab-btn" data-tab="raw">
                            JSON bruto (debug)
                        </button>
                    </div>

                    <div id="tabProcessed" class="tab-panel">
                        <div id="resultsList" class="jobs-list">
                            <div class="empty-state">
                                Nenhuma busca executada ainda. Preencha os filtros e clique em
                                <strong>Buscar vagas</strong>.
                            </div>
                        </div>
                    </div>

                    <div id="tabRaw" class="tab-panel hidden">
                        <pre id="rawJson" class="json-raw">
Nenhum retorno ainda. Execute uma busca para ver o JSON da Unipile aqui.
            </pre>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script>
        // 1) CONFIGURA√á√ÉO ‚Äì ATUALIZE AQUI SE PRECISAR TROCAR O WEBHOOK DO MAKE
        const MAKE_WEBHOOK_URL =
            "https://hook.us2.make.com/zx8d6n1t5lar6edyi68lalyhckfbdjh4";

        const form = document.getElementById("searchForm");
        const btnReset = document.getElementById("btnReset");
        const statusLine = document.getElementById("statusLine");
        const resultsCount = document.getElementById("resultsCount");
        const resultsHint = document.getElementById("resultsHint");
        const resultsList = document.getElementById("resultsList");
        const rawJsonEl = document.getElementById("rawJson");

        const tabButtons = document.querySelectorAll(".tab-btn");
        const tabProcessed = document.getElementById("tabProcessed");
        const tabRaw = document.getElementById("tabRaw");

        function setStatus(message, type = "info") {
            statusLine.textContent = message;
            statusLine.classList.remove("ok", "error");
            if (type === "ok") statusLine.classList.add("ok");
            if (type === "error") statusLine.classList.add("error");
        }

        function getSelectedSeniorities() {
            const boxes = form.querySelectorAll('input[name="seniority"]:checked');
            const values = Array.from(boxes).map((b) => Number(b.value));
            if (values.length === 0) {
                // fallback: diretor / executivo
                return [3, 4];
            }
            return values;
        }

        // 2) SUBMISS√ÉO DO FORMUL√ÅRIO ‚Äì CHAMA O MAKE / UNIPILE
        form.addEventListener("submit", async (event) => {
            event.preventDefault();

            const keywords = form.keywords.value.trim();
            const location = form.location.value.trim();
            const experienceLevels = getSelectedSeniorities();

            if (!keywords) {
                setStatus("Informe pelo menos uma palavra-chave para a vaga.", "error");
                return;
            }

            setStatus("Enviando filtros para o Make/Unipile...", "info");
            resultsHint.textContent = " (processando busca...)";

            const payload = {
                keywords,
                location,
                seniorities: experienceLevels,
            };

            try {
                const response = await fetch(MAKE_WEBHOOK_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(payload),
                });

                if (!response.ok) {
                    throw new Error("Erro HTTP " + response.status);
                }

                const rawText = await response.text();
                rawJsonEl.textContent = rawText || "(resposta vazia)";

                let data;
                try {
                    data = JSON.parse(rawText);
                } catch (e) {
                    // Se n√£o der para parsear, mantemos s√≥ o texto bruto
                    data = null;
                }

                if (!data) {
                    setStatus(
                        "Resposta recebida, mas n√£o foi poss√≠vel interpretar o JSON.",
                        "error"
                    );
                    resultsHint.textContent =
                        " (veja o JSON bruto na aba de debug para diagn√≥stico)";
                    renderResults(null);
                    return;
                }

                setStatus("Busca conclu√≠da com sucesso.", "ok");
                renderResults(data);
            } catch (error) {
                console.error("Erro ao chamar webhook do Make:", error);
                setStatus(
                    "Erro ao buscar vagas. Verifique o cen√°rio do Make / Unipile.",
                    "error"
                );
                resultsHint.textContent =
                    " (erro na chamada ‚Äì veja o console / JSON bruto para detalhes)";
            }
        });

        // 3) LIMPAR FORMUL√ÅRIO
        btnReset.addEventListener("click", () => {
            form.keywords.value = "";
            form.location.value = "";
            form
                .querySelectorAll('input[name="seniority"]')
                .forEach((b) => (b.checked = false));
            resultsList.innerHTML =
                '<div class="empty-state">Filtros limpos. Informe novos crit√©rios e clique em <strong>Buscar vagas</strong>.</div>';
            resultsCount.textContent = "0";
            resultsHint.textContent = " (aguardando nova busca)";
            setStatus("Filtros limpos.", "info");
        });

        // 4) TROCA DE ABAS (PROCESSADO / JSON BRUTO)
        tabButtons.forEach((btn) => {
            btn.addEventListener("click", () => {
                tabButtons.forEach((b) => b.classList.remove("active"));
                btn.classList.add("active");

                const tab = btn.dataset.tab;
                if (tab === "processed") {
                    tabProcessed.classList.remove("hidden");
                    tabRaw.classList.add("hidden");
                } else {
                    tabProcessed.classList.add("hidden");
                    tabRaw.classList.remove("hidden");
                }
            });
        });

        // 5) RENDERIZA√á√ÉO DAS VAGAS A PARTIR DO JSON DA UNIPILE
        function renderResults(data) {
            // Estrutura t√≠pica da Unipile para LinkedIn Search:
            // { object: "LinkedInSearch", items: [ { type: "JOB", title, location, url, company: { name }, posted_at, ... } ] }

            let items = [];

            if (data && Array.isArray(data.items)) {
                items = data.items;
            } else if (data && data.data && Array.isArray(data.data.items)) {
                // fallback, caso o Make embrulhe em { data: { items: [...] } }
                items = data.data.items;
            }

            if (!items || items.length === 0) {
                resultsList.innerHTML =
                    '<div class="empty-state">Nenhuma vaga encontrada para os filtros informados.</div>';
                resultsCount.textContent = "0";
                resultsHint.textContent = " (0 vagas no retorno da API)";
                return;
            }

            resultsCount.textContent = String(items.length);
            resultsHint.textContent = " (vagas retornadas pela API da Unipile)";

            const fragment = document.createDocumentFragment();

            items.forEach((job) => {
                const title = job.title || "T√≠tulo n√£o informado";
                const companyName =
                    (job.company && job.company.name) || "Empresa n√£o informada";
                const location = job.location || "Localiza√ß√£o n√£o informada";
                const url =
                    job.url ||
                    (job.company && job.company.profile_url) ||
                    "https://www.linkedin.com/jobs/";
                const postedAt = formatDate(job.posted_at);

                const card = document.createElement("article");
                card.className = "job-card";

                card.innerHTML = `
          <div class="job-title-line">
            <div>
              <div class="job-title">${escapeHtml(title)}</div>
              <div class="job-company">${escapeHtml(companyName)}</div>
              <div class="job-location">${escapeHtml(location)}</div>
            </div>
          </div>
          <div class="job-meta">
            <div class="job-date">
              Publicado em: ${postedAt}
            </div>
            <a href="${escapeAttribute(
                    url
                )}" target="_blank" rel="noopener noreferrer" class="job-link">
              Ver no LinkedIn
            </a>
          </div>
        `;

                fragment.appendChild(card);
            });

            resultsList.innerHTML = "";
            resultsList.appendChild(fragment);
        }

        function formatDate(isoString) {
            if (!isoString) return "Data n√£o informada";
            const d = new Date(isoString);
            if (Number.isNaN(d.getTime())) return isoString;
            return d.toLocaleDateString("pt-BR", {
                day: "2-digit",
                month: "2-digit",
                year: "numeric",
            });
        }

        // Helpers simples para evitar XSS em strings vindas da API
        function escapeHtml(str) {
            return String(str)
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function escapeAttribute(str) {
            return String(str).replace(/"/g, "&quot;");
        }
    </script>
</body>

</html>
